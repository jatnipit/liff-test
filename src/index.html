<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <span id="loading">Loading</span>

    <div id="lineProfile" style="display: none">
      <img
        id="lineImage"
        width="100px"
        src="https://fastly.picsum.photos/id/999/100/100.jpg?hmac=y8YoMd7Y5eLqlpcBum4ddyPcONcBDAp8c8IoIjkXFQY"
        alt=""
      />
      <div id="lineName">Hello Name</div>
      <div id="lineUID">UID: Your UID</div>

      <div>
        <input id="lineMessage" type="text" />
        <button onclick="sendMessage()">Send message</button>
      </div>
    </div>

    <button id="logout" onclick="logout()">Logout</button>

    <script
      charset="utf-8"
      src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.10.0/axios.min.js"
      integrity="sha512-WkZrEcQ5LMyNy6Y2PQf+Tu3vMcsmKKRKuPXtJSTHQJ3mpuvLRlA5dlDDhrrcXfyWr6Z/y3wIMfjfqVFO/gDZYQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      let userId = "";

      const main = async () => {
        await liff.init({ liffId: "2007596133-8wqZynwK" });
        if (!liff.isLoggedIn()) liff.login();

        const profile = await liff.getProfile();

        loading.style.display = "none";

        lineImage.src = profile.pictureUrl;
        lineName.textContent = `Hello ${profile.displayName}`;
        lineUID.textContent = `UID: ${profile.userId}`;
        lineProfile.style.display = "block";

        userId = profile.userId;
      };

      const logout = async () => {
        liff.logout();

        window.location.reload();
      };

      const sendMessage = async () => {
        try {
          if (!lineMessage.value) {
            throw new Error("message not found");
          }
          const response = await axios.post(
            "https://22af-2405-9800-b920-9c21-f53f-5d01-aabb-61aa.ngrok-free.app/send-message",
            {
              userId,
              message: lineMessage.value,
            }
          );

          console.log("response: ", response.data);
        } catch (error) {
          console.log(error);
        }
      };

      main();
    </script>
  </body>
</html>
